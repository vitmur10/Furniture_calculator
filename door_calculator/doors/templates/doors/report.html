{% extends 'base.html' %}
{% block content %}
<div class="container py-5">
  <h2 class="fw-bold mb-4 text-center">üìà –ó–≤—ñ—Ç –ø–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö</h2>

  <form method="get" class="card p-3 shadow-sm mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label fw-bold">–ó –¥–∞—Ç–∏</label>
        <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">–ü–æ –¥–∞—Ç—É</label>
        <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
      </div>
      <div class="col-md-4 text-end mt-3">
        <button class="btn btn-primary">üîç –ü–æ–∫–∞–∑–∞—Ç–∏</button>
        <a href="?export=excel&start_date={{ start_date }}&end_date={{ end_date }}" class="btn btn-success">üì• –ï–∫—Å–ø–æ—Ä—Ç Excel</a>
      </div>
    </div>
  </form>

  {% if orders %}
  <div class="card shadow-sm">
    <table class="table table-striped align-middle mb-0">
      <thead class="table-primary">
        <tr>
          <th>‚Ññ</th>
          <th>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ö/–°</th>
          <th>–í–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω)</th>
          <th>–í–∏–∫–æ–Ω–∞–Ω–æ (%)</th>
          <th>–î–∞—Ç–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr class="{% if o.status == 'postponed' %}table-warning{% elif o.status == 'completed' %}table-success{% endif %}">
          <td>{{ forloop.counter }}</td>
          <td>‚Ññ{{ o.order_number }}</td>
          <td>{{ o.get_status_display }}</td>
          <td>{{ o.total_ks }}</td>
          <td>{{ o.total_cost }}</td>
          <td>{{ o.completion_percent }}%</td>
          <td>{{ o.created_at|date:"d.m.Y" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-4">
    <h5 class="fw-bold">üìä –ü—ñ–¥—Å—É–º–∫–∏:</h5>
    <ul class="list-group">
      <li class="list-group-item">–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: {{ orders.count }}</li>
      <li class="list-group-item">–ê–∫—Ç–∏–≤–Ω—ñ: {{ active_orders.count }} | –í—ñ–¥–∫–ª–∞–¥–µ–Ω—ñ: {{ postponed_orders.count }}</li>
      <li class="list-group-item">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å: <strong>{{ total_value|floatformat:2 }} –≥—Ä–Ω</strong></li>
      <li class="list-group-item">–°–µ—Ä–µ–¥–Ω—ñ–π % –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: <strong>{{ avg_progress|floatformat:1 }}%</strong></li>
    </ul>
  </div>
  {% else %}
  <div class="alert alert-info mt-4 text-center">–ù–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥</div>
  {% endif %}
</div>
{% endblock %}
