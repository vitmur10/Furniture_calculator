{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}
<div class="container py-4">
  <h4 class="fw-bold mb-3">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó ‚Äî ‚Ññ{{ order.order_number }}</h4>

  <form method="post" class="card p-4 shadow-sm">
    {% csrf_token %}

    <div class="row g-3">
      <div class="col-md-8">
        <label class="form-label fw-bold">–ù–∞–∑–≤–∞ –ø–æ–∑–∏—Ü—ñ—ó</label>
        <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–∑–∏—Ü—ñ–π</label>
        <input type="number" name="quantity" min="1" class="form-control" value="{{ item.quantity }}">
      </div>
    </div>

    <hr class="my-4">

    <div class="row">
      <div class="col-lg-6">
        <h6 class="fw-bold mb-2">–í–∏—Ä–æ–±–∏</h6>
        <div class="border rounded p-2" style="max-height: 360px; overflow:auto;">
          {% for p in products %}
          <label class="d-flex align-items-center gap-2 py-1 border-bottom">
            <input type="checkbox" name="products" value="{{ p.id }}"
                   {% if p.id in selected_products_ids %}checked{% endif %}>
            {% if p.image %}<img src="{{ p.image.url }}" width="40" height="40" style="object-fit:cover;border-radius:6px">{% endif %}
            <span>{{ p.name }} ({{ p.base_ks }} –∫/—Å){% if p.category %} ‚Äî <small class="text-muted">{{ p.category.name }}</small>{% endif %}</span>
          </label>
          {% empty %}
          <div class="text-muted small">–ù–µ–º–∞—î –≤–∏—Ä–æ–±—ñ–≤</div>
          {% endfor %}
        </div>
      </div>

      <div class="col-lg-6">
        <h6 class="fw-bold mb-2">–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏</h6>
        <div class="border rounded p-2" style="max-height: 360px; overflow:auto;">
          {% for c in coefficients %}
          <label class="d-inline-flex align-items-center gap-2 me-3 my-1">
            <input type="checkbox" name="coefficients" value="{{ c.id }}"
                   {% if c.id in selected_coeffs_ids %}checked{% endif %}>
            <span>{{ c.name }} √ó{{ c.value }}</span>
          </label>
          {% empty %}
          <div class="text-muted small">–ù–µ–º–∞—î –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <hr class="my-4">

    <h6 class="fw-bold mb-2">–î–æ–ø–æ–≤–Ω–µ–Ω–Ω—è (–∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é)</h6>
    <div class="border rounded p-2" style="max-height: 360px; overflow:auto;">
      {% for a in addons %}
      <div class="input-group input-group-sm mb-2">
        <div class="input-group-text">
          <input type="checkbox" class="form-check-input mt-0" name="additions" value="{{ a.id }}"
                 {% if a.id in addition_qty %}checked{% endif %}>
        </div>
        <span class="input-group-text w-50">{{ a.name }}</span>
        <input type="number" class="form-control" name="add_qty_{{ a.id }}" min="1"
               value="{{ addition_qty|get_item:a.id|default:1 }}">
        <span class="input-group-text">{{ a.ks_value }} –∫/—Å</span>
      </div>
      {% empty %}
      <div class="text-muted small">–ù–µ–º–∞—î –¥–æ–ø–æ–≤–Ω–µ–Ω—å</div>
      {% endfor %}
    </div>

    <div class="d-flex gap-2 mt-4">
      <a href="{% url 'calculate_order' order.id %}" class="btn btn-outline-secondary">‚¨ÖÔ∏è –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</a>
      <button class="btn btn-primary">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
      <a href="{% url 'order_item_delete' item.id %}" class="btn btn-danger ms-auto"
         onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –ø–æ–∑–∏—Ü—ñ—é?')">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</a>
    </div>
  </form>
</div>
{% endblock %}
