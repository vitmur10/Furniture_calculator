{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}

<div class="container py-5">
  <h3 class="fw-bold text-center mb-4">üìä –ó–≤—ñ—Ç –≤–∏—Ä–æ–±—ñ—Ç–∫—É –∑–∞ –ø–µ—Ä—ñ–æ–¥</h3>

  <!-- üîπ –§–æ—Ä–º–∞ –≤–∏–±–æ—Ä—É –ø–µ—Ä—ñ–æ–¥—É -->
  <form method="get" class="card p-3 shadow-sm mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label fw-bold">–ó –¥–∞—Ç–∏</label>
        <input type="date" name="start_date" class="form-control" value="{{ start_date|date:'Y-m-d' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">–ü–æ –¥–∞—Ç—É</label>
        <input type="date" name="end_date" class="form-control" value="{{ end_date|date:'Y-m-d' }}">
      </div>
      <div class="col-md-4 text-end mt-3">
        <button class="btn btn-primary px-4">üîç –ü–æ–∫–∞–∑–∞—Ç–∏</button>
      </div>
    </div>
  </form>

  {% if table %}
  <!-- üîπ –¢–∞–±–ª–∏—Ü—è –∑–≤—ñ—Ç—É -->
  <div class="table-responsive card shadow-sm">
    <table class="table table-bordered table-striped text-center align-middle mb-0">
      <thead class="table-primary">
        <tr>
          <th rowspan="2" class="align-middle">–î–∞—Ç–∞</th>
          <th colspan="{{ orders|length }}">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è (% –≤–∏–∫–æ–Ω–∞–Ω–Ω—è)</th>
          <th colspan="{{ workers|length }}">–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏ (–≥–æ–¥)</th>
          <th rowspan="2" class="align-middle">Œ£ –≥–æ–¥ –∑–∞ –¥–µ–Ω—å</th>
        </tr>
        <tr>
          {% for o in orders %}
            <th>‚Ññ{{ o }}</th>
          {% endfor %}
          {% for w in workers %}
            <th>{{ w }}</th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        {% for row in table %}
        <tr>
          <td class="fw-bold">{{ row.date|date:"d.m" }}</td>

          {# –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: –≤—ñ–¥—Å–æ—Ç–∫–∏ –Ω–∞ —Ü—é –¥–∞—Ç—É #}
          {% for o in orders %}
            <td>{{ row|get_item:o|floatformat:1 }}</td>
          {% endfor %}

          {# –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏: –≥–æ–¥–∏–Ω–∏ #}
          {% for w in workers %}
            <td>{{ row|get_item:w|floatformat:1 }}</td>
          {% endfor %}

          <td class="fw-bold bg-light">{{ row.total|floatformat:1 }}</td>
        </tr>
        {% endfor %}

        <!-- üîπ –ü—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä—è–¥–æ–∫ -->
        <tr class="table-secondary fw-bold">
          <td>Œ£ –∑–∞ –ø–µ—Ä—ñ–æ–¥</td>

          {# –ø–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ–π % –≤–∏–∫–æ–Ω–∞–Ω–Ω—è #}
          {% for o in orders %}
            <td>
              {{ totals_orders|get_item:o|floatformat:1 }}%
            </td>
          {% endfor %}

          {# –ø–æ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞—Ö ‚Äî —Å—É–º–∞—Ä–Ω—ñ –≥–æ–¥–∏–Ω–∏ #}
          {% for w in workers %}
            <td>{{ totals_workers|get_item:w|floatformat:1 }}</td>
          {% endfor %}
          <td>{{ total_all|floatformat:1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- üîπ –ü—ñ–¥—Å—É–º–∫–æ–≤—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –ø–æ –≥–æ–¥–∏–Ω–∞—Ö (–Ω–æ—Ä–º–∞) -->
  <div class="mt-4">
    <h5 class="fw-bold">üìà –ü—ñ–¥—Å—É–º–∫–æ–≤—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏:</h5>
    <ul class="list-group shadow-sm">
      <li class="list-group-item">
        –ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ —É –ø–µ—Ä—ñ–æ–¥—ñ:
        <strong>{{ work_days }}</strong>
      </li>
      <li class="list-group-item">
        –ó–∞–≥–∞–ª–æ–º –≤–∏–∫–æ–Ω–∞–Ω–æ:
        <strong>{{ total_all|floatformat:1 }} –≥–æ–¥</strong>
      </li>
      <li class="list-group-item">
        –ù–æ—Ä–º–∞ ({{ work_days }} √ó 8 √ó 0.75):
        <strong>{{ norm_hours|floatformat:1 }} –≥–æ–¥</strong>
      </li>
      <li class="list-group-item">
        –í–∏–∫–æ–Ω–∞–Ω–æ –≤—ñ–¥ –Ω–æ—Ä–º–∏:
        <strong class="{% if percent_done >= 100 %}text-success{% else %}text-danger{% endif %}">
          {{ percent_done|floatformat:1 }}%
        </strong>
      </li>
    </ul>
  </div>

  {% else %}
  <div class="alert alert-info text-center mt-4">
    –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –∑–∞ –≤–∏–±—Ä–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥
  </div>
  {% endif %}
</div>

{% endblock %}
